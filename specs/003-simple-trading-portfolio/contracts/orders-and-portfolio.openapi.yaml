openapi: 3.0.3
info:
  title: RNExchange Simple Trading & Portfolio (M2)
  version: 0.1.0
  description: Minimal contracts for cash-only trading loop (orders, positions, ledger).

paths:
  /api/orders:
    post:
      summary: Place a new cash order
      description: Submit a Market or Limit BUY/SELL order for a CASH trading account.
      operationId: createOrder
      tags:
        - Trading
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewOrderRequest'
      responses:
        '201':
          description: Order accepted (may be immediately filled)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
        '400':
          description: Validation error (e.g., inactive instrument, invalid quantity, insufficient funds, non-marketable limit)
        '401':
          description: Unauthorized
        '403':
          description: Forbidden for this trading account

  /api/trading-accounts/{id}/positions:
    get:
      summary: Get positions for a trading account
      description: Returns current positions for the given CASH trading account.
      operationId: getPositionsForAccount
      tags:
        - Portfolio
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
        - name: size
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
      responses:
        '200':
          description: Positions for this account
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PositionView'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden for this trading account

  /api/trading-accounts/{id}/ledger-entries:
    get:
      summary: Get cash ledger entries for a trading account
      description: Returns recent cash ledger entries (credits and debits) for the given CASH trading account.
      operationId: getLedgerEntriesForAccount
      tags:
        - Portfolio
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
        - name: size
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
      responses:
        '200':
          description: Ledger entries for this account
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LedgerEntryView'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden for this trading account

components:
  schemas:
    NewOrderRequest:
      type: object
      required:
        - tradingAccountId
        - instrumentId
        - side
        - type
        - quantity
      properties:
        tradingAccountId:
          type: string
        instrumentId:
          type: string
        side:
          type: string
          enum: [BUY, SELL]
        type:
          type: string
          enum: [MARKET, LIMIT]
        quantity:
          type: integer
          minimum: 1
        limitPrice:
          type: number
          format: double
          nullable: true

    OrderResponse:
      type: object
      properties:
        id:
          type: string
        tradingAccountId:
          type: string
        instrumentId:
          type: string
        side:
          type: string
          enum: [BUY, SELL]
        type:
          type: string
          enum: [MARKET, LIMIT]
        quantity:
          type: integer
        limitPrice:
          type: number
          format: double
          nullable: true
        state:
          type: string
          enum: [NEW, ACCEPTED, FILLED, REJECTED]
        rejectionReason:
          type: string
          nullable: true
        executionPrice:
          type: number
          format: double
          nullable: true

    PositionView:
      type: object
      properties:
        instrumentId:
          type: string
        symbol:
          type: string
        quantity:
          type: integer
        averageCost:
          type: number
          format: double
        lastPrice:
          type: number
          format: double
        mtm:
          type: number
          format: double

    LedgerEntryView:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
          enum: [DEBIT, CREDIT]
        amount:
          type: number
          format: double
        description:
          type: string
        createdAt:
          type: string
          format: date-time


